<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Demo Page for BrowserDataProtection</title>
</head>

<body>
  <h1>BrowserDataProtection Demo Page</h1>

  <div>
    <strong>Field 1: symmetric, user-only, immediate</strong>
    <div id="field1"></div>
    <code id="ciphertextField1"></code>
  </div>

  <div>
    <strong>Field 2: symmetric, user-only, on-submit</strong>
    <div id="field2"></div>
  </div>

  <div>
    <strong>Field 3: Password key</strong>
    <div id="field3"></div>
    <code id="ciphertextField3"></code>
  </div>

  <div>
    <strong>Field 4: symmetric, external, immediate</strong>
    <div id="field4"></div>
    <code id="ciphertextField4"></code>
    Exported key (password: "f")
    <textarea id="field4-exported-password-key" readonly rows="6"
      cols="200">eyJrZXlJZCI6ImZhMWM3M2E4ODY2ZGNmZDljY2ZiYWExMmIwNWNkZmRmIiwiaXYiOiIwMWRrd2tWQ3ZNZ2t2S3ZxIiwiY2lwaGVydGV4dCI6IjBCaEJDMjRnSjlvQmxablRFaEVRNnZTUXBidXV5TWJvcmduNzFKOFhVOGxkTk5QN1lCc0RzeXU0bXlNeWhwRDdFc0I1R1NGdnBEdC9JY3Y5UkRDU1FjWVhzNSs0b0VhU0YyR0owanAyOGRyMlFyQ2hpM29qamc1all2ODQwbHg4WWxoVDRlckVkZUtmd1dxcjJlTzQxOVd3ODRTbDFFMlJ5Vk9aejlPdE5kSS94TFdteENXbktSb3VCNXpXdnJ6UVk1TXJoSFFSWHY2bC9EZmJmVGhUTUZ3a3AydGd1YUo1eG95Zk5vNm1hZHhJbFppWDIvZVZpOVNIbmNobzdwVkhLNGROMy8wcU1LZzBkTGVpQXBVbktpMzY3akg4NGRkaHdpQU9kTDY3YzFsMmVzNTB0by9kRTBYL2JhR3BIZ3VUVURuR2ozeVZORjBydFNWQ3hTa0tUNktBZFdsa0tudGxJbUhwbzA2cHhqdWlkSzVQS21tTm9WRmZPdG9MQjJNa2pMckVHQ3M0YUI1a1R1M3ZpVy9acEJxa2toU3JwYTUvVVVFaTRyTUUrdU4zMzNxd0oxZm5wYU9NNXNaVjY3UTdYSFV3bUdoTkxNUUdhUnNzN3dFPSIsInNhbHQiOiI3bzlsTXVaUG1BRGE1WjBHSUFTZzVwYWVUZlFBSDRVcmhjdDVRajZpIn0=</textarea>
  </div>

  <div>
    <strong>Field 5: symmetric, key agreement, immediate</strong>
    <div id="field5"></div>
    <code id="ciphertextField5"></code>
    <code id="field5-public-key-id-display"></code>
    <textarea id="field5-public-key-display" readonly
      placeholder="Public key generated by this browser will be displayed here." rows="6" cols="200"></textarea>
    <p>
      <strong>Provide a public key (of another party) for this field.</strong>
      Normally, the key would be transmitted through the web application server. For this serverless demo, the key is
      directly copy-pasted from the display field of this demo page in another browser.
    </p>
    <textarea id="field5-public-key-input" placeholder="Provide a public key (of another party) for this field."
      rows="6" cols="200"></textarea>
    <button id="field5-public-key-submit">Provide this public key</button>
  </div>

  <div>
    <strong>Field 6: recipient, direct-plain, immediate</strong>
    <div id="field6"></div>
    <code id="ciphertextField6"></code>
  </div>

  <div>
    <strong>Field 7: recipient, external, immediate</strong>
    <div id="field7"></div>
    <code id="ciphertextField7"></code>
  </div>

  <p>
    <a href="empty.html">Page without fields</a>
  </p>
  <script type="text/javascript">
    (async function () {
      const ciphertextField1 = document.getElementById('ciphertextField1')
      const field1 = document.getElementById('field1')
      const cryptoField1 = await window.browserDataProtection.createProtectedField(field1, {
        protectionMode: 'symmetric',
        distributionMode: 'user-only',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField1.innerText = ciphertext
        },
      })
      console.log(cryptoField1)
      cryptoField1.setCiphertext('{"keyId":"d76800c9e5ea3ac6eebc6c5cdab7ff37","iv":"7SJzVTQiAnyZehX1","ciphertext":"a1l6OkNgazFKV3ytA/mCPIDwxvQaDXA="}')
      setTimeout(() => {
        cryptoField1.setCiphertext('{"keyId":"d76800c9e5ea3ac6eebc6c5cdab7ff37","iv":"d3GkEnTXzmFIfOX7","ciphertext":"Y7XVMYFxg4/x67cB9Et9U9nO"}')
        // cryptoField1.setCiphertext(null)
      }, 2000)

      const field2 = document.getElementById('field2')
      const cryptoField2 = await window.browserDataProtection.createProtectedField(field2, {
        protectionMode: 'symmetric',
        distributionMode: 'user-only',
        updateMode: 'on-submit',
      })
      console.log(cryptoField2)

      /*
      // DEBUG
      function clickFieldAndTimeout (fieldA, fieldB) {
        fieldA.click()
        setTimeout(() => clickFieldAndTimeout(fieldB, fieldA), 3000)
      }
      setTimeout(() => clickFieldAndTimeout(field1, field2), 50)
      */

      const ciphertextField3 = document.getElementById('ciphertextField3')
      const field3 = document.getElementById('field3')
      const cryptoField3 = await window.browserDataProtection.createProtectedField(field3, {
        protectionMode: 'password',
        updateMode: 'on-submit',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField3.innerText = ciphertext
        },
      })
      cryptoField3.setCiphertext('{"keyId":"81f06e43e9acdf47b0db0edefd2e903f","iv":"a/jMS4UnWiccKK7o","ciphertext":"ASq3UMIUwE5/pOKlC8T65h7r/xI=","salt":"qrnmFOnTTbmvQ+Tt5xEKTuXwIxUmDE/58HPXhZmf"}')
      console.log(cryptoField3)

      const ciphertextField4 = document.getElementById('ciphertextField4')
      const field4 = document.getElementById('field4')
      const cryptoField4 = await window.browserDataProtection.createProtectedField(field4, {
        protectionMode: 'symmetric',
        distributionMode: 'external',
        updateMode: 'immediate',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField4.innerText = ciphertext
        },
      })
      cryptoField4.setCiphertext('{"keyId":"b534d57cc90cb15b83c90b652e154ed4","iv":"bj9CrLeQVQGSQrSx","ciphertext":"/xXIBA5B5Ujafk4XAij07fsrC1LPiA=="}')
      console.log(cryptoField4)

      const ciphertextField5 = document.getElementById('ciphertextField5')
      const field5 = document.getElementById('field5')
      const field5KeyDisplay = document.getElementById('field5-public-key-display')
      const field5KeyIdDisplay = document.getElementById('field5-public-key-id-display')
      const field5KeyInput = document.getElementById('field5-public-key-input')
      const field5KeySubmit = document.getElementById('field5-public-key-submit')
      const cryptoField5 = await window.browserDataProtection.createProtectedField(field5, {
        protectionMode: 'symmetric',
        distributionMode: 'key-agreement',
        updateMode: 'immediate',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField5.innerText = ciphertext
        },
        publicKeyProvidedCallback (publicKey, publicKeyId) {
          console.log('Field 5 received public key', publicKey, 'with id', publicKeyId)
          field5KeyDisplay.value = publicKey
          field5KeyIdDisplay.innerText = publicKeyId
        }
      })
      field5KeySubmit.addEventListener('click', () => {
        cryptoField5.providePublicKey(field5KeyInput.value)
      })
      // cryptoField5.setCiphertext('{"keyId":"b534d57cc90cb15b83c90b652e154ed4","iv":"bj9CrLeQVQGSQrSx","ciphertext":"/xXIBA5B5Ujafk4XAij07fsrC1LPiA=="}')
      console.log(cryptoField5)

      const ciphertextField6 = document.getElementById('ciphertextField6')
      const field6 = document.getElementById('field6')
      const cryptoField6 = await window.browserDataProtection.createProtectedField(field6, {
        protectionMode: 'recipient',
        distributionMode: 'direct-plain',
        updateMode: 'immediate',
        recipientPublicKey: 'eyJrZXlJZCI6IjJjMjM0YzU4MDRkNDAxYzAxNzMyNDg4NjdkNzQ2NGEwIiwic2hvcnREZXNjcmlwdGlvbiI6IlRlc3QiLCJjcmVhdGVkIjoxNjk4MTU2NDUzMjc2LCJsYXN0VXNlZCI6bnVsbCwiYWxsb3dlZE9yaWdpbnMiOlsiKiJdLCJwcmV2aW91c2x5VXNlZE9uT3JpZ2lucyI6W10sInByaXZhdGVLZXkiOnsiYWxnb3JpdGhtIjp7Im5hbWUiOiJSU0EtT0FFUCIsImhhc2giOnsibmFtZSI6IlNIQS0yNTYifSwibW9kdWx1c0xlbmd0aCI6NDA5NiwicHVibGljRXhwb25lbnQiOiJBUUFCIn0sImtleURhdGEiOnsiYWxnIjoiUlNBLU9BRVAtMjU2IiwiZCI6IkVkRG1lOElDby1fT0pNTUxIdkFKai1YVFRqMFptSk9FVDVkaVY2TXM0dTl4Y0VMTGxsZE1pUFNnc19iRC1hYjRaeGV4NHRmYllNOGVWZE5jOWRhV2VwRHpDT21PQmhnaER1akFCQmFGYmVlRlpoT2JTVHdoTGtEdjhDcVB6N2pzREluZ3BlUWZjSmk3MTNLUVZiaEdwOVBnenZYRkJ6Y21HejhGbmF6Z0lYNVo4OWQzbHF2VVZxRC16QjV5WS1kZWlzUWExU2dMSExnYlZ4OWtCVmI0cEFmMWNBdURJdnd0dDdDdXVNcGhNUzlXWVlTNDRDQWRwT1JTY1l5elVxT0d2dmJmR2dHSDQ5Z3hRcE5UVkVKN2dBbjlrbjJyTDBXcGZWeUNla3hHOXF0SGRTNEE2WHRCSUN0SWZxMUNpN1pqT1hJbWlLbjQ4cUNWbEh6SVp5TWducTZvME9veTFxVW9lYUpRMkJ0R2hSTHBCeDdSNG02eVpBeDRnbnVqVUpWLU1mOWRFakwyZkZ1UnhSZHg4WEtkWEg0UjZMNXkydXF0eGZXbFZONXRXN0lJVUpsUjBtakl0dHo3alpfTDhpMGhVSF9aWURkNXRmMmFLRnJRUkh0dkRrTEg0S0ROZDJORUU1LWVaY1RMSGtFUWtydF9yVXNTNkcxajdWMUpYcGpQZXRReE01VUV5Sjc4OWVJVXZiX2Zkc253Mko1Q1FIUVo5YW82V0pjdEhGbk1vcWVic0F0RElZMi1JZlVEbTlTTzFUX0lIN01jbUVpN3VDRHdETmxQRU9BTlF5bkdBS0FYVktaTUk2dGlKY0R5bThzZjhsV3NMT3MyNUFvR3Ruai1vSWQxYnhuOUVHelRPbXJWc2FEN21zc1NMbWhXT0Y0dGdrRGlrU2Q5ZjhrIiwiZHAiOiJhMENWYldFcDBRWGc5S3g4WmhzcVdkWFFoY01odjB3MDMyMG5iYzdGWV9SQ0lrUjJvcmFmSjBTNUh5dW9NNE1UWU8yeEVTSFV6UGo1dkItbWFZMDcwVm5CRTJGeTh0M0hCejVSQnpybUN6SzIxTlo1UV9XVWdJTTFtWUl3enYwRjlTQzBVdkZseHNLeTlibzR4SXFfSWl4dGJDaDFYOWJlR08yVGdYY2hVV1BpVlhYQ2Y3UUVVb3FDZDJZOUhqLUVmMHhIVzd1SGtZVWwxMGdwUk9qNHNnZF9lWVl0YXVkRXlyOWVfRDdZNFNrVFJSdzhHSHNZdU9Uam54dVJzUHJFbnVGR2ktcFpSQXVSWEotME9mNkRpanNHSGxkUTR1SWVsWTM0LV9mWGhvZW13ZVdvVm81TlhEeFRjSHMxcGczNU5WM3dFWHE5OUtzN21qOTdnOFB5VlEiLCJkcSI6IkFubVJZcHozTHo2M2VqVnRXMFB0V3NkMGpjeTdDRXhiTjY0ZFVyeWk2TTRScUZ3aDVyN2lhcmU4THRKcU9rWmRhSFlMbm1wd19aNG0tTWsxbjVKR3FZX2FjVVYxWWxfeW1QMUFKQVctOU9tdWpibEc1UVpyNzAwQ0FqWVF5UTRQN3ZTY2Q1RXZoLU56SVl2WUduZFMxS3B3eUdBVDFmUEowQUozZU44dUtKQ2FUMnQzSHh2Z0gtcGRUNl9OTi1YY0tOeUtkbFc5dlJhTEZyTi1IV2hUMlRKaHVKVjFVZ3VJVDhrdEM0ZXdUNE5fMkpITERnMjBVWFdSUWpMdnlSaGYzSFFBSE4zTFh4N0NQeUtoWkttY1NUR2N0Wm1BS0ZiY1pwSU1LRUVFTk9id25ic0ZsZEtwS2g4Z1pnTGdpRFdXa0ZIYl9iMXg0Q3J4b1lSQ1F6UkFRUSIsImUiOiJBUUFCIiwiZXh0Ijp0cnVlLCJrZXlfb3BzIjpbImRlY3J5cHQiXSwia3R5IjoiUlNBIiwibiI6ImwySEJzSTdNdF9VdXQ5bC1zRGI2X0cyaXZIaHBFakUzMUpPUVVGODFWMVh4Yy1CbHUtd01XdnN0RHplR3F5bW4tdlZQMTI2eXlZenV2UzFVMTVlR3NXc28ybW9ielZzbGtyclQtOVgyNjN5S3FFOXYtdS1FbkJFUV8wRFNHMDZmQ0RJWFNzM2ttN3lTTFkwV0pjcVRUY2lYdFpzSWtBMjM3RUY3RDZZdDhyMWVLeUR3Z1NpeExfQV9vV0doZkFhV0tNZVlmS0NFNjhMTVhPUlMza2NwQmhnREw3b0J2Zzk5ZlZfbTB1NHREdnlSSTJKOWJET1NHeFVlMUhWa0xrdkpoR0tVSUVoSk1xOVptM09ab0VXUFRUZkgyM2NMV1drajZjTWZkVnF2aXo0OG54a3gzbG1pbFFvMktublp1dTJMT3NLUU5SODROamZWYXk5VGlkTlJONmJFMnJyQ1llT194VlM2aU92Z2RUMENPR1paYWoyX1dwMjlDTWtINTdXYmZiblNSSG9SdzJlU2pJUTRFYUVheDcyWUR2QjVabC1nb0ZSZmhLcFJLc2xlRVZHcV82TU5JcEdvZ2M5eGR6LWZsX1doVUt3dXdPOE9CU3pNNXNCdjBJMFZMVVVUdXJjZ3V0cjl1M3NienhxbVQ3TjZyb3lJNGpmVks4ZHdkdFlOTlRTM3JSSkZMQjluVUxLVnBwXzJVcHQwNlAwYkVvOVF1Zk5yTkpTLVFOcUFZMUJwS01LX0Y3RXZ3TjR4SUJrWmxVNjJVZ2hRckVMVlZRQ0RyT3NaeWVkVldmSTJTYmhmRDhVVDhMbkdfMEJnZFFSMEFKaEx5ekhQbDktby16cjRpMDRFeWQ4ODRoV2hGNlZscm9vTkd5TTdWamFyX0hFTW1pNjY1UFdadENNIiwicCI6IjBrS1JGWkdoTnBrRWtYcDhxSGZWSjVlUTFoUWU5TUlNdldDZUJLdzdvUTVXQ0J0RXhxY2JlYTV1bzVPUGs4WklTaUs0YTlnS2h5aUh5LUJZeDBESHRGS0otTExQM1pOOF81RHU5ekZuQzBORUtvNkRKcEkwdzAxWU5UeEJBaVNVc3o1TXNwLWY0VzhKTFdPZHlYa0pYV2dKSWZBOGx6cGFGYTh5dzRuNEFsNG9lVnlGYVBKREdoTFF0R3hJXzNBdFV6Y3ItSnZfeXlxdF9RTnpRZ3Jxdi1mZnlLbUJPZEpUbTU5MnZTR0EtUHd3a1RBZGtJYm9ySjUxZ0VyZVl2RXp1N3pXTm5fc3dGYnBVYS1wTkVzSENSb044cGd6U3gyR1BSVXpiZVZKSm11bDFXMEVwR3J1eWhZMGdneXlsdUxoSWxEUTVtM2VvMTE1SEpaU0ZmVmJQdyIsInEiOiJ1RkJBRFh2ZVVOZ1FqMlB5UE9IdEFXWTB1bzQwcWJhTXo0UElaS1NOT0NPZ0hfQmQ3WnhEOVAxYVdBZEpnbl9vWXNBRjg4eWdtVm5GZ21GSVgyT1BGSU45X19pZ2lJaHRwNFQ3dHoxZ01RNzQyR01XeDExZXdYQVhDNmh2ZEFkRTgxdkNZUkFIUzFiOHpJQjYycGpRU2EzTm5vRTVtOUZpMmE1bEN6Nk40N1pkR1BQd2RUeEpQNDk3OFRKTXRtdzhJeHprNk1sVW10aDgzd0ZtcVhBVEQ4YXF3T3pGckhkZ1lpMmZuNkd5OTh5ZEhHZDBVYXpvZS1UZEJkXy0ySHVmcUtfZnE1dl9HamhBalE0ZURJS2FhbkZ0SndyNzRYVy1GdElfZ1lGTU1jbkFNZTVZcnAzMXdULVJ5Umt0SGJVcm5Bemo5TWdJblZST0dQeHg0VkFpSFEiLCJxaSI6IkoxM0xzb1dkSmw3MDVocmxob3pZWjJFY2N3cU5Hc19pT1lXOXMxei1MT2lGUHlXMjhrN3B2T2c2MWxNWVdpUV9MWUlNZ19uVXRkakphV09lY2JMR0pKZXIyVXBhb2tUWDFuaVhxWGVGY3E0NnowcVBxNHNkUUhJYVJ3cjNrT0h0eS1WRDFteWw1N1k3SGpOU0Q4c3BEZkFmQ1paSGZkc1BmQXVJSDEtMlQ1R2NOTkFlN0RCdkJlcnpEcWlFbVhlaG55Umg0cUItYl8xT2tNMlJhNG5nQUVSYzFkZUxGRVRVS0VyUlY3alRpdlJEM00yMFVxem9yM09RVFNJSDVVTUV6LURtWTNNd2hhNEtnNmVnZ095LUd1TG14dGhxNkFPaFRWVVkzNkl6bnNoblJSeHp5cG1lOVd6SzdULUFiTlk0WGlxU0JoM045UXhzdzBVODNQMDNsZyJ9fSwicHVibGljS2V5Ijp7ImFsZ29yaXRobSI6eyJuYW1lIjoiUlNBLU9BRVAiLCJoYXNoIjp7Im5hbWUiOiJTSEEtMjU2In0sIm1vZHVsdXNMZW5ndGgiOjQwOTYsInB1YmxpY0V4cG9uZW50IjoiQVFBQiJ9LCJrZXlEYXRhIjp7ImFsZyI6IlJTQS1PQUVQLTI1NiIsImUiOiJBUUFCIiwiZXh0Ijp0cnVlLCJrZXlfb3BzIjpbImVuY3J5cHQiXSwia3R5IjoiUlNBIiwibiI6ImwySEJzSTdNdF9VdXQ5bC1zRGI2X0cyaXZIaHBFakUzMUpPUVVGODFWMVh4Yy1CbHUtd01XdnN0RHplR3F5bW4tdlZQMTI2eXlZenV2UzFVMTVlR3NXc28ybW9ielZzbGtyclQtOVgyNjN5S3FFOXYtdS1FbkJFUV8wRFNHMDZmQ0RJWFNzM2ttN3lTTFkwV0pjcVRUY2lYdFpzSWtBMjM3RUY3RDZZdDhyMWVLeUR3Z1NpeExfQV9vV0doZkFhV0tNZVlmS0NFNjhMTVhPUlMza2NwQmhnREw3b0J2Zzk5ZlZfbTB1NHREdnlSSTJKOWJET1NHeFVlMUhWa0xrdkpoR0tVSUVoSk1xOVptM09ab0VXUFRUZkgyM2NMV1drajZjTWZkVnF2aXo0OG54a3gzbG1pbFFvMktublp1dTJMT3NLUU5SODROamZWYXk5VGlkTlJONmJFMnJyQ1llT194VlM2aU92Z2RUMENPR1paYWoyX1dwMjlDTWtINTdXYmZiblNSSG9SdzJlU2pJUTRFYUVheDcyWUR2QjVabC1nb0ZSZmhLcFJLc2xlRVZHcV82TU5JcEdvZ2M5eGR6LWZsX1doVUt3dXdPOE9CU3pNNXNCdjBJMFZMVVVUdXJjZ3V0cjl1M3NienhxbVQ3TjZyb3lJNGpmVks4ZHdkdFlOTlRTM3JSSkZMQjluVUxLVnBwXzJVcHQwNlAwYkVvOVF1Zk5yTkpTLVFOcUFZMUJwS01LX0Y3RXZ3TjR4SUJrWmxVNjJVZ2hRckVMVlZRQ0RyT3NaeWVkVldmSTJTYmhmRDhVVDhMbkdfMEJnZFFSMEFKaEx5ekhQbDktby16cjRpMDRFeWQ4ODRoV2hGNlZscm9vTkd5TTdWamFyX0hFTW1pNjY1UFdadENNIn19fQ==',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField6.innerText = ciphertext
        },
      })
      // cryptoField6.setCiphertext('{"keyId":"b534d57cc90cb15b83c90b652e154ed4","iv":"bj9CrLeQVQGSQrSx","ciphertext":"/xXIBA5B5Ujafk4XAij07fsrC1LPiA=="}')
      console.log(cryptoField6)

      const ciphertextField7 = document.getElementById('ciphertextField7')
      const field7 = document.getElementById('field7')
      const cryptoField7 = await window.browserDataProtection.createProtectedField(field7, {
        protectionMode: 'recipient',
        distributionMode: 'external',
        updateMode: 'immediate',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField7.innerText = ciphertext
        },
      })
      // cryptoField7.setCiphertext('{"keyId":"b534d57cc90cb15b83c90b752e154ed4","iv":"bj9CrLeQVQGSQrSx","ciphertext":"/xXIBA5B5Ujafk4XAij07fsrC1LPiA=="}')
      console.log(cryptoField7)

      setTimeout(() => field6.click(), 50)
    })();
  </script>
</body>

</html>