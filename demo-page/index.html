<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Demo Page for BrowserDataProtection</title>
</head>

<body>
  <h1>BrowserDataProtection Demo Page</h1>

  <div>
    <strong>Field 1: symmetric, user-only, immediate</strong>
    <div id="field1"></div>
    <code id="ciphertextField1"></code>
  </div>

  <div>
    <strong>Field 2: symmetric, user-only, on-submit</strong>
    <div id="field2"></div>
  </div>

  <div>
    <strong>Field 3: Password key</strong>
    <div id="field3"></div>
    <code id="ciphertextField3"></code>
  </div>

  <div>
    <strong>Field 4: symmetric, external, immediate</strong>
    <div id="field4"></div>
    <code id="ciphertextField4"></code>
    Exported key (password: "f")
    <textarea readonly rows="6" cols="200">eyJrZXlJZCI6IjQ3ZTdlZDAzM2UxODlhMWYzYTYyYjFkOGFhMjI4NTNmIiwiaXYiOiJsYXBVV2pqWGlvekdYUVh0IiwiY2lwaGVydGV4dCI6InZnZGx4UXQ1QTdzODhmd3dHYlEzMnc4U3gxcGNaWXZ2VDd5VXpuZGN1SnNabXoxQTVVc0dRQnVVNEZIR2U3aDQ3aFh5Zjg3TDBxT1JsT1h5Y2NIUkxTd2pUTFFpZ3QyZFNzOVRxZ2VOZE1HdnJ1UXVpR0lGZHM1UmswakJmZjJZMXE2STIydmpJK1pIQjllRVhUNEEwOUpvWXJtZFpPUTc2bElBZ3lYc3RYSWNGWEdLVjczSEJ3KzVsTkxoQWpQQ0lkd3ZIUExBTnBVVSt6djFXNkpuY1JDcUdqWTBaT1FBdTRGbS8xa0dDT0pFaGNYSGE4N0tNMllVUTRJTmRaT3dJRkxqS0tkTHBMVnkrYllqNWI1UUk0RjVSTllGQnVRcjFWWVJNNnhWRFJEWU83d29zSm15SkNndWVmV280UUl5c2F3OWVXYkhlbnVScGVjb1l0UWNRbDJxQ3hDTEpTeGNqSkdZU0IvUmQvN3hQYlc4SzI0ZkpiNHBKNGF5VlY4bGttN3Byc0F2VHlsMEdWMFg4TUd3aFhkd3RQWXMycmlsMkRRcGZMUlZNREFDSmVWMlV5RzhrZG1sTkZwbTNEc2lJSnBWeXRHVDVDT0krcWNrN3d0eXEyeVVPbFU5enE4cjVhYVVySTBpZDNJWHB2MXk1em9ON3lISngwa0V0VUtqcEN4VTAzMkFtVkhXQlA0WGlhM0NYanM0Yi96VlZGUzlvMnQvdFh6MjZHd0pyb1A3THRmNFl0MD0iLCJzYWx0IjoiT3hFc2RjaUxUZG9JcTVtVFRGN3JhWmhUMllJSU9hSUlpbllZQTg4SyJ9</textarea>
  </div>

  <p>
    <a href="empty.html">Page without fields</a>
  </p>
  <script type="text/javascript">
    (async function () {
      const ciphertextField1 = document.getElementById('ciphertextField1')
      const field1 = document.getElementById('field1')
      const cryptoField1 = await window.browserDataProtection.createProtectedField(field1, {
        protectionMode: 'symmetric',
        distributionMode: 'user-only',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField1.innerText = ciphertext
        }
      })
      console.log(cryptoField1)
      cryptoField1.setCiphertext('{"keyId":"d76800c9e5ea3ac6eebc6c5cdab7ff37","iv":"7SJzVTQiAnyZehX1","ciphertext":"a1l6OkNgazFKV3ytA/mCPIDwxvQaDXA="}')
      setTimeout(() => {
        cryptoField1.setCiphertext('{"keyId":"d76800c9e5ea3ac6eebc6c5cdab7ff37","iv":"d3GkEnTXzmFIfOX7","ciphertext":"Y7XVMYFxg4/x67cB9Et9U9nO"}')
        // cryptoField1.setCiphertext(null)
      }, 2000)

      const field2 = document.getElementById('field2')
      const cryptoField2 = await window.browserDataProtection.createProtectedField(field2, {
        protectionMode: 'symmetric',
        distributionMode: 'user-only',
        updateMode: 'on-submit',
      })
      console.log(cryptoField2)

      /*
      // DEBUG
      function clickFieldAndTimeout (fieldA, fieldB) {
        fieldA.click()
        setTimeout(() => clickFieldAndTimeout(fieldB, fieldA), 3000)
      }
      setTimeout(() => clickFieldAndTimeout(field1, field2), 50)
      */

      const ciphertextField3 = document.getElementById('ciphertextField3')
      const field3 = document.getElementById('field3')
      const cryptoField3 = await window.browserDataProtection.createProtectedField(field3, {
        protectionMode: 'password',
        updateMode: 'on-submit',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField3.innerText = ciphertext
        }
      })
      cryptoField3.setCiphertext('{"keyId":"81f06e43e9acdf47b0db0edefd2e903f","iv":"a/jMS4UnWiccKK7o","ciphertext":"ASq3UMIUwE5/pOKlC8T65h7r/xI=","salt":"qrnmFOnTTbmvQ+Tt5xEKTuXwIxUmDE/58HPXhZmf"}')
      console.log(cryptoField3)

      const ciphertextField4 = document.getElementById('ciphertextField4')
      const field4 = document.getElementById('field4')
      const cryptoField4 = await window.browserDataProtection.createProtectedField(field4, {
        protectionMode: 'symmetric',
        distributionMode: 'external',
        updateMode: 'immediate',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField4.innerText = ciphertext
        }
      })
      cryptoField4.setCiphertext('{"keyId":"b534d57cc90cb15b83c90b652e154ed4","iv":"bj9CrLeQVQGSQrSx","ciphertext":"/xXIBA5B5Ujafk4XAij07fsrC1LPiA=="}')
      console.log(cryptoField4)

      setTimeout(() => field4.click(), 50)
    })();
  </script>
</body>

</html>