<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Demo Page for BrowserDataProtection</title>
</head>

<body>
  <h1>BrowserDataProtection Demo Page</h1>
  <div id="field1"></div>
  <code id="ciphertextField1"></code>

  <div id="field2"></div>

  <div id="field3"></div>

  <p>
    <a href="empty.html">Page without fields</a>
  </p>
  <script type="text/javascript">
    (async function () {
      const ciphertextField1 = document.getElementById('ciphertextField1')
      const field1 = document.getElementById('field1')
      const cryptoField1 = await window.browserDataProtection.createProtectedField(field1, {
        protectionMode: 'user-only',
        distributionMode: 'local',
        ciphertextChangedCallback (ciphertext) {
          ciphertextField1.innerText = ciphertext
        }
      })
      console.log(cryptoField1)
      cryptoField1.setCiphertext('{"keyId":"aee8f9a3b6b57293ed5cddc4c6cd2515","iv":"KQo88Nf4Vpj6M3K+","ciphertext":"kWwXG0CfNSeQObfgK1+WED0B"}')
      setTimeout(() => {
        cryptoField1.setCiphertext('{"keyId":"aee8f9a3b6b57293ed5cddc4c6cd2515","iv":"YGE6KgPR7FGrcuYa","ciphertext":"0ecV/FOf688u3HZjT09aUV5dnAs="}')
        /// cryptoField1.setCiphertext(null)
      }, 2000)

      const field2 = document.getElementById('field2')
      const cryptoField2 = await window.browserDataProtection.createProtectedField(field2, {
        protectionMode: 'user-only',
        distributionMode: 'local',
        updateMode: 'on-submit',
      })
      console.log(cryptoField2)

      setTimeout(() => field1.click(), 50)
      /*
      // DEBUG
      function clickFieldAndTimeout (fieldA, fieldB) {
        fieldA.click()
        setTimeout(() => clickFieldAndTimeout(fieldB, fieldA), 3000)
      }
      setTimeout(() => clickFieldAndTimeout(field1, field2), 50)
      */

      const field3 = document.getElementById('field3')
      const cryptoField3 = await window.browserDataProtection.createProtectedField(field3, {
        protectionMode: 'password',
      })
      console.log(cryptoField2)
    })();
  </script>
</body>

</html>